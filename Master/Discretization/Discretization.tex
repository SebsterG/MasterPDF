\section{Discretization of monolithic FSI equations}\label{Discretization}
After introducing all the equations and boundary conditions needed to solve a FSI problem. We are ready to discretize the equations into one monolithic scheme. The equations will be discretized and solved using finite difference and finite element methods. I will introduce a so called $\theta$-scheme which will make it easy to implement different schemes, by choosing a value for $\theta$.
I will briefly introduce the spaces needed to discretize, following the ideas and notations of \cite{Wick2011}:

\subsubsection{Spaces}
Let $ X \in \mathbb{R}^d , d \in\{ 1,2  \} $ be a time dependent domain we define:

\begin{equation}
\hat{V}_X := H^1(X), \hspace{6mm}  \hat{V}^1_X := H^1_0(X) 
\end{equation}

$ H^1 $ indicating a Hilbert space and

\begin{equation}
\hat{L}_X := L^2(X), \hspace{6mm} \hat{L}^0_X := L^2(X) / \mathbb{R}
\end{equation}

$L^2$ indicating a standard Lebesque space.

The trial and test spaces for the velocity variable in the fluid domain,

\begin{equation}
\hat{V}^0_{f,u} := \{ \hat{u} \in H^1_0(\mathcal{F}) : \hat{u}_f = \hat{u}_s \hspace{2mm} on \hspace{2mm} \hat{\Sigma}  \}
\end{equation}

and the same for the artificial displacement in the moving fluid domain:

\begin{equation}
\hat{V}^0_{f,d} := \{ \hat{d} \in H^1_0(\mathcal{F}) : \hat{d}_f = \hat{d}_s \hspace{2mm} on \hspace{2mm} \hat{\Sigma}  \}
\end{equation}
\begin{equation}
\hat{V}^0_{f,d} := \{ \hat{d} \in H^1_0(\mathcal{F}) : \hat{\psi_f} = \hat{\psi_s} \hspace{2mm} on \hspace{2mm} \hat{\Sigma}  \}
\end{equation}

Now that the spaces have been defined we are ready to discretize. The temporal discretization is done using finite difference schemes and the spatial is treated with the finite element method. I will employ a $\theta-$ scheme that will enables us to easily switch between schemes.

\subsubsection{Discretization}

In the domain $\Omega$ and time interval [0,T]:

Find $ U = \{\bold{u}, d, p\} \in \hat{X}^0_D $ where $ \hat{X}^0_D := \{ \bold{u}^D_f + \hat{V}^0_{f,\bold{u}} \} \times \hat{L}_f \times \{ d_f^D + \hat{V}^0_{f,\hat{f}} \} \times \{ d_f^D + \hat{V}^0_{f,\hat{f}} \} \times \hat{L}^0_f \times \hat{L}^0_s  $ such that:

\begin{equation}
\int_0^T A(U)(\Psi) dt = \int_0^T \hat{F}(\Psi) dt \hspace{4mm} \forall  \Psi \in \hat{X}
\end{equation}

where $ \Psi = \{\phi, \psi, \gamma \} $% \hat{\psi}^\bold{u}_f, \hat{\psi}^\bold{u}_s, \hat{\psi}^d_f, \hat{\psi}^d_s, \hat{\psi}^p_f,\hat{\psi}^p_f  \}$ and

 $\hat{X} = \hat{V}^0_{f,\bold{u}} \times \hat{L}_f \times \hat{V}^0_{f,d,\hat{\Sigma}} \times \hat{V}_s^0 \times \hat{L}_f^0 \times \hat{L}_s^0  $


I first introduce the scheme using, for simplicity, the harmonic mesh motion. Let $\bold{u}$ be a global function in the entire domain instead of $\bold{u}_f$ in the fluid and $\bold{u}_s$ in the solid. Same for the test functions. This is done for ease of reading and also for the ease of implementation later.

The full monolithic FSI variational form reads:
\begin{align}
A(U)&= (J \rho_f \partial_t \bold{u} , \phi ) - (J (\nabla u)F^{-1}(\bold{u} - \partial_t d) , \phi )_{\mathcal{\hat{F}}}  \\
       &+ ( J \sigma_{f} F^{-T} , \nabla \phi )_{\mathcal{\hat{F}}} \\
       &+ (\rho_s \partial_t \bold{u} , \phi)_{\mathcal{\hat{S}}}   + \big(F S_s, \nabla \phi \big)_{\mathcal{\hat{S}}} \\
       &+ ( \alpha_u \nabla \bold{u}, \nabla \psi)_{\mathcal{\hat{F}}} + (\nabla \cdot (J F^{-1} \bold{u}),\gamma )_{\mathcal{\hat{F}}} \\
       \label{eq:condition}
       &+ \delta\big((\partial_t d , \psi)_{\mathcal{\hat{S}}}  - ( \bold{u} , \psi )_{\mathcal{\hat{S}}}\big) \\ 
       &+  \big( J \sigma_{f,p} F^{-T}, \nabla \phi  \big) 	 		
\end{align}

The condition \eqref{eq:condition} , is weighted with a $\delta$ value. This is a critical detail for the program (detailed later) to run. The only two places where we use the test function $\psi$ is on this condition and the lifting operator. The weighting says in a weak manner that this condition is important for the overall program. \newline

I will here formulate the \textit{One step-$\theta$ scheme} from \cite{Wick2011}. This $\theta$ scheme has the advantage of easily being changed from the backward (implicit), forward(excplicit) or Crank-Nicholson (implicit) scheme. The backward Euler scheme is of first order and is implicit in that it is using the newest time step appears on both sides of the equation. The Crank-Nicholson is of second order and both the current and previous time step is used. This scheme suffers from instabilities in its normal context, we will therefore look at a \textit{shifted} Crank-Nicholson scheme. 

We define the variational form by dividing into four categories, this may seem strenuous at first but the need for it will become evident when implementing the $\theta$-scheme. The four divided categories consists of: a time term, implicit, pressure and the rest (stress, convection):

\begin{align}
A_T(U) &= (J \rho_f \partial_t \bold{u} , \phi ) - (J (\nabla u)F^{-1}(\partial_t d) , \phi )_{\mathcal{\hat{F}}} \\
	    & + (\rho_s \partial_t \bold{u} , \phi)_{\mathcal{\hat{S}}} + (\partial_t d , \psi)_{\mathcal{\hat{S}}}  \\
A_I(U) &= ( \alpha_u \nabla \bold{u}, \nabla \psi)_{\mathcal{\hat{F}}} + (\nabla \cdot (J F^{-1} \bold{u}), \gamma)_{\mathcal{\hat{F}}} \\
A_E(U) &= (J (\nabla u)F^{-1} \bold{u} , \phi )_{\mathcal{\hat{F}}} + ( J \sigma_{f,u} F^{-T} , \nabla \phi )_{\mathcal{\hat{F}}} \\
	    & + \big(F S_s, \nabla \phi \big)_{\mathcal{\hat{S}}} - ( \bold{u} , \psi )_{\mathcal{\hat{S}}} \\
A_P(U) &= \big( J \sigma_{f,p} F^{-T}, \nabla \phi  \big)  	 		
\end{align}

Notice that the stress tensors have been split into a velocity and pressure part. 
\begin{align}
\sigma_{f,u} &= \mu ( \nabla u F^{-1} + F^{-T} \nabla u) \\
\sigma_{f,p} &= -p I
\end{align}

For the time group, discretization is done in the following way:
\begin{align}
A_T(U^{n,k}) \approx & \frac{1}{k} \big( \rho_f J^{n,\theta} (u^n - u^{n-1}) , \phi  \big)_{\mathcal{\hat{F}}} - \frac{1}{k} \big( \rho_f (\nabla u ) (d^n - d^{n-1}) , \phi \big)_{\mathcal{\hat{F}}} \\
+ & \frac{1}{k} \big( \rho_s J^{n,\theta} (u^n - u^{n-1}) , \phi  \big)_{\mathcal{\hat{S}}} +  \frac{1}{k} \big(  J^{n,\theta} (d^n - d^{n-1}) , \psi  \big)_{\mathcal{\hat{S}}}
\end{align}
And the Jacobian is written with superscript $\theta$ as:

\begin{equation}
J^{n, \theta} = \theta J^n + (1-\theta)J^{n-1}
\end{equation}

We can now introduce the \textit{One step-$\theta$ scheme}: 
Find $U^n = \{u^n , d^n, p^n \}$

\begin{align}
& A_T(U^{n,k}) + \theta A_E(U^{n}) + A_P(U^{n}) + A_I(U^{n}) = \\
& - (1-\theta) A_E(U^{n-1}) + \theta \hat{f}^n + (1-\theta) \hat{f}^{n-1}  
\end{align}

We notice that the scheme is selected by the choice of $\theta $. By choosing $ \theta = 1$ we get the back Euler scheme, for $ \theta = \frac{1}{2}$ we get the Crank-Nicholson scheme and shifted Crank-Nicholson we set $ \theta = \frac{1}{2} + k$, effectively shifting the scheme towards the implicit side. $\hat{f}$ is the body forces which will be ignored in this thesis. The shifting toward the implicit side is important for long term stability for certain time step values \cite{Wick2011}. The shifting will be investigated in the next chapter.






